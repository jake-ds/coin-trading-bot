# Ralph Progress Log — V4 Live-Ready Dashboard & Infrastructure
Started: 2026-02-22

## Codebase Patterns
- **Strategy pattern**: All strategies extend BaseStrategy ABC, register via strategy_registry.register()
- **Async-first**: All I/O uses async/await. Strategy analyze() is async.
- **Config**: pydantic-settings with .env + YAML override. New features disabled by default.
- **Testing**: pytest + pytest-asyncio. Always clean strategy_registry in fixtures.
- **Imports**: Always update __init__.py when adding new modules.
- **Dependencies**: Add to pyproject.toml AND requirements.txt.
- **Dashboard state**: Module-level dict in bot.dashboard.app. Test fixtures must reset all fields.
- **API endpoints**: V4 moves to /api/* prefix. /health stays at root for Docker healthcheck.
- **Frontend build**: npm run build outputs to src/bot/dashboard/static/. FastAPI serves as SPA.
- **Auth**: JWT via python-jose. Disabled when dashboard_password='changeme'.
- **Baseline**: 1494 tests passing on V3 branch (V2 + V3 complete).
- **API Router**: All API endpoints use `api_router = APIRouter(prefix="/api")`. Legacy HTML at `/legacy`.
- **Test URL prefix**: All test HTTP calls use `/api/` prefix (e.g., `/api/status`, `/api/trades`). `/health` stays at root.
- **SPA fallback**: `/{full_path:path}` catch-all serves index.html. Must be defined AFTER all API routes.
- **Frontend scaffold**: Vite + React 18 + TypeScript + Tailwind CSS 3 + react-router-dom v6.
- **Makefile**: `make frontend-install`, `make frontend-dev`, `make frontend-build`, `make test`, `make lint`.

---

## 2026-02-22 - V4-001
- Created frontend/ directory with Vite + React 18 + TypeScript + Tailwind CSS 3
- Files created:
  - frontend/package.json, tsconfig.json, tsconfig.node.json, vite.config.ts
  - frontend/tailwind.config.js, postcss.config.js, index.html
  - frontend/src/main.tsx, App.tsx, index.css, vite-env.d.ts
  - frontend/src/api/client.ts (axios with /api base + 401 interceptor)
  - frontend/src/api/types.ts (TypeScript types matching Python models)
  - frontend/src/pages/Dashboard.tsx, Trades.tsx, Strategies.tsx, Settings.tsx, Login.tsx
- Modified src/bot/dashboard/app.py:
  - Added APIRouter with `/api` prefix for all data endpoints
  - Moved HTML dashboard to `/legacy` route
  - Added SPA static file serving with index.html fallback
  - /health available at both root and /api/health
  - Added StaticFiles mount for built frontend assets
- Updated 5 test files for /api/ prefix:
  - tests/dashboard/test_app.py (all endpoint paths + dashboard HTML → /legacy)
  - tests/dashboard/test_v2_026_enhanced_dashboard.py (all paths + HTML → /legacy)
  - tests/test_v2_022_strategy_tracker.py (/strategies → /api/strategies)
  - tests/test_v3_integration.py (/quant/* → /api/quant/*)
  - tests/test_v2_007_cycle_safety.py (/status → /api/status)
- Created Makefile with frontend-install, frontend-dev, frontend-build, test, lint targets
- Updated .gitignore: added frontend/node_modules/, frontend/dist/, src/bot/dashboard/static/
- Tests: 1494 passing (all existing tests updated for /api/ prefix), ruff clean
- Frontend: npm run build succeeds (TypeScript + Vite)
- **Learnings for future iterations:**
  - APIRouter prefix means endpoint decorators use `/status` not `/api/status`
  - SPA catch-all route `/{full_path:path}` must be last to avoid catching API routes
  - /health stays at root for Docker healthcheck AND at /api/health for API consistency
  - Legacy dashboard at /legacy preserves backward compatibility for test assertions
  - Test count baseline: 1494 tests passing as of V4-001
---

## 2026-02-22 - V4-002
- Built Dashboard overview page with portfolio metrics, status, and regime display
- Files created:
  - frontend/src/components/common/StatusBadge.tsx (running/stopped badge with pulse animation)
  - frontend/src/components/common/MetricCard.tsx (reusable metric display card)
  - frontend/src/components/common/RegimeBadge.tsx (color-coded market regime badge)
  - frontend/src/components/common/PortfolioSummary.tsx (portfolio value + return display)
  - frontend/src/components/common/Skeleton.tsx (loading skeleton components)
- Files modified:
  - frontend/src/pages/Dashboard.tsx (full implementation with data fetching)
- Features:
  - Fetches /api/status, /api/portfolio, /api/metrics, /api/regime on mount via Promise.allSettled
  - Auto-refresh every 10 seconds via useEffect interval
  - Loading skeleton states (PortfolioSummarySkeleton, MetricCardSkeleton)
  - Error state with styled error message
  - Responsive grid: 1 col mobile, 2 cols tablet, 3 cols desktop
  - Dark theme by default (bg-gray-800/900 cards, gray-700 borders)
  - Color-coded metrics: green=positive, red=negative, amber=warning
  - Regime badge colors: green=trending up, red=trending down, amber=ranging, purple=volatile
  - Cycle info panel: cycle count, avg duration, last cycle time
- Tests: 1494 passing (no Python changes), ruff clean, frontend builds clean
- **Learnings for future iterations:**
  - Promise.allSettled is better than Promise.all for dashboard — partial data is better than no data
  - Components in frontend/src/components/common/ for reuse across pages
  - No Python backend changes needed — all endpoints already existed from V3
---
