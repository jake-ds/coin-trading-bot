# Ralph Progress Log - v2 Improvements
Started: 2026-02-22
Previous run: 25/25 stories completed, 267 tests passing
---

## Codebase Patterns
- Python 3.10 is available (not 3.11+); pyproject.toml requires-python set to >=3.10
- Use `asdf local python 3.10.0` to ensure correct Python version
- ruff enforces import sorting (isort rules) â€” stdlib imports before third-party before local
- FrozenModel (frozen=True) used as base for immutable data models
- Enums in models/base.py: OrderSide, OrderType, OrderStatus, SignalAction
- Import from `bot.models` for all model types and enums
- Settings loads from .env and optional YAML config file; use `config_file="nonexistent.yaml"` in tests
- `register_adapter(name, cls)` registers exchange adapters; `ExchangeFactory.create(name, **kwargs)` instantiates
- Registry is case-insensitive (stored as lowercase)
- Use `_adapter_registry` fixture cleanup in tests to avoid leaking between tests
- `load_settings(**overrides)` convenience function for creating Settings
- Strategy registry is a global singleton: `strategy_registry` from `bot.strategies.base`
- Strategies auto-register on module import via `strategy_registry.register(Instance())`
- Tests use `clean_registry` fixture to reset singleton state
- DataStore uses async sessions; always use `async with self._session_factory() as session:`
- In-memory SQLite for tests: `sqlite+aiosqlite://` (no file path) or `sqlite+aiosqlite:///:memory:`
- CircuitBreaker states: CLOSED -> OPEN -> HALF_OPEN
- Paper trading Orders get id prefix `paper-`
- greenlet is required for SQLAlchemy async
- Use `ccxt.async_support` for async adapters; patch `bot.exchanges.binance.ccxt.binance` in tests
- structlog: use logging.DEBUG/INFO/etc. instead of get_level_from_name
- httpx AsyncClient with ASGI transport for FastAPI test client
- asyncio.create_task for delayed stop in trading loop tests
- .gitignore `data/` must be `/data/` (root only) to avoid ignoring src/bot/data/
---
